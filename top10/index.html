<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Top 10 Member</title>
  <style>
    :root{
      --bg1:#2e6bff;
      --bg2:#2b56c7;
      --card:#ffffff;
      --muted:#6b7280;
      --shadow: 0 10px 30px rgba(0,0,0,.12);
      --radius: 18px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;}
    body{margin:0;background:#eaf0ff;}
    .app{
      min-height:100vh;
      background: linear-gradient(180deg,var(--bg1),var(--bg2));
      color:#fff;
      padding-bottom:24px;
    }
    .topbar{
      display:flex; align-items:center; gap:12px;
      padding:18px 16px 10px;
    }
    .back{
      width:34px;height:34px;border-radius:10px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.22);
      cursor:pointer;
      user-select:none;
    }
    .title{flex:1;text-align:center;font-weight:800;letter-spacing:.6px;}
    .spacer{width:34px;height:34px;}

    .toolbar{
      display:flex; gap:10px; align-items:center;
      margin: 0 16px 10px;
    }
    select{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(255,255,255,.18);
      color:#fff;
      font-weight:800;
      outline:none;
    }
    option{color:#0b1220;}

    .tabs{
      margin:10px 16px 14px;
      background:rgba(0,0,0,.14);
      border:1px solid rgba(255,255,255,.18);
      border-radius:999px;
      padding:6px;
      display:flex;
      gap:6px;
    }
    .tab{
      flex:1;
      padding:10px 12px;
      border-radius:999px;
      text-align:center;
      font-weight:700;
      cursor:pointer;
      background:transparent;
      color:rgba(255,255,255,.85);
      border:0;
    }
    .tab.active{
      background:rgba(255,255,255,.18);
      color:#fff;
    }

    .content{
      position:relative;
      padding: 0 16px;
    }

    /* podium area */
    .podium{
      margin-top:8px;
      display:grid;
      grid-template-columns: 1fr 1.1fr 1fr;
      align-items:end;
      gap:12px;
    }
    .pod{
      text-align:center;
      position:relative;
    }
    .medal{
      width:68px;height:68px;border-radius:50%;
      margin:0 auto 6px;
      display:grid;place-items:center;
      border:4px solid rgba(255,255,255,.85);
      background:rgba(255,255,255,.18);
      box-shadow: var(--shadow);
    }
    .medal.gold{border-color:#ffd56a;background:rgba(255,213,106,.25);}
    .medal.silver{border-color:#e8eefc;background:rgba(232,238,252,.18);}
    .medal.bronze{border-color:#ffb38a;background:rgba(255,179,138,.20);}
    .rankBadge{
      position:absolute; top:-6px; right:22px;
      width:28px;height:28px;border-radius:50%;
      background:#ffcc3a;color:#13224a;
      display:grid;place-items:center;
      font-weight:900;font-size:14px;
      border:2px solid rgba(0,0,0,.08);
    }
    .name{font-weight:800; margin-top:2px;}
    .trx{opacity:.9;font-weight:700;font-size:13px;}
    .pillar{
      margin:10px auto 0;
      width:100%;
      max-width:210px;
      border-radius:16px;
      background: linear-gradient(180deg, rgba(255,255,255,.20), rgba(0,0,0,.10));
      border:1px solid rgba(255,255,255,.16);
      height: 130px;
      display:grid;place-items:center;
      font-weight:900;
      color:rgba(255,255,255,.95);
    }
    .pillar.one{height:160px;}
    .pillar.three{height:120px;}

    /* bottom sheet list */
    .sheet{
      margin-top:14px;
      background: var(--card);
      color:#0b1220;
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 14px 12px 6px;
    }
    .sheetHandle{
      width:54px;height:6px;border-radius:999px;
      background:#dbe4ff;
      margin:2px auto 12px;
    }
    .row{
      display:flex; align-items:center; gap:12px;
      padding: 12px 10px;
      border-radius: 16px;
      background:#f6f8ff;
      margin-bottom:10px;
      border:1px solid #e7ecff;
    }
    .rank{
      min-width:40px;height:34px;border-radius:12px;
      background:#4c7dff;
      color:#fff;font-weight:900;
      display:grid;place-items:center;
    }
    .avatar{
      width:38px;height:38px;border-radius:50%;
      background:#e7ecff;
      display:grid;place-items:center;
      color:#6276b9;
      font-weight:900;
    }
    .rowMain{flex:1;min-width:0;}
    .rowName{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .rowTrx{font-weight:800;color:#2d4fb8; text-align:right; min-width:66px;}
    .muted{color:var(--muted);font-weight:600;font-size:13px;margin-top:2px;}

    /* info panel */
    .infoCard{
      background: var(--card);
      color:#0b1220;
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 16px 14px;
    }
    .infoCard h3{margin:0 0 8px;font-size:18px}
    .infoCard h4{margin:14px 0 6px;font-size:16px}
    .infoCard ul{margin:0;padding-left:18px}
    .infoCard li{margin:6px 0;color:#1f2a44;font-weight:600}
    .note{margin-top:10px;color:#334155;font-weight:600;font-size:13px;line-height:1.4}

    .error{
      margin: 12px 16px 0;
      background: rgba(255,80,80,.18);
      border:1px solid rgba(255,80,80,.35);
      padding:10px 12px;
      border-radius:14px;
      font-weight:700;
    }
    .loading{
      margin: 12px 16px 0;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="back" onclick="history.back()">‚Üê</div>
      <div class="title">TOP 10 MEMBER</div>
      <div class="spacer"></div>
    </div>

    <div class="toolbar">
      <select id="monthSelect" aria-label="Pilih bulan">
        <option value="2026-02">Februari 2026</option>
        <option value="2026-01">Januari 2026</option>
        <option value="2025-12">Desember 2025</option>
      </select>
    </div>

    <div class="tabs">
      <button class="tab active" id="tabLeaderboard">Februari 2026</button>
      <button class="tab" id="tabInfo">Informasi</button>
    </div>

    <div id="status"></div>

    <div class="content" id="viewLeaderboard">
      <div class="podium">
        <div class="pod">
          <div class="rankBadge">2</div>
          <div class="medal silver">üë§</div>
          <div class="name" id="name2">-</div>
          <div class="trx" id="trx2">- Trx</div>
          <div class="pillar">2<br/>Rank</div>
        </div>

        <div class="pod">
          <div class="rankBadge">1</div>
          <div class="medal gold">üë§</div>
          <div class="name" id="name1">-</div>
          <div class="trx" id="trx1">- Trx</div>
          <div class="pillar one">1<br/>Rank</div>
        </div>

        <div class="pod">
          <div class="rankBadge">3</div>
          <div class="medal bronze">üë§</div>
          <div class="name" id="name3">-</div>
          <div class="trx" id="trx3">- Trx</div>
          <div class="pillar three">3<br/>Rank</div>
        </div>
      </div>

      <div class="sheet">
        <div class="sheetHandle"></div>
        <div id="list"></div>
      </div>
    </div>

    <div class="content" id="viewInfo" style="display:none;">
      <div class="infoCard">
        <h3>Cara Ikut</h3>
        <ul>
          <li>Perbanyak transaksi setiap bulannya</li>
          <li>Hanya transaksi <b>berhasil/selesai</b> yang terhitung</li>
          <li>Tidak melakukan topup ilegal (hasil penipuan/pencucian uang & sejenisnya)</li>
          <li>Pembagian hadiah setiap awal bulan</li>
        </ul>

        <h4>Hadiah Event</h4>
        <ul>
          <li><b>Top 1</b>: 200+ Trx = Rp20.000</li>
          <li><b>Top 2</b>: 100+ Trx = Rp10.000</li>
          <li><b>Top 3</b>: 50+ Trx = Rp5.000</li>
        </ul>

        <div class="note">
          Hadiah di atas hanya didapat jika mencapai target. Jika tidak mencapai target, maka Top1‚ÄìTop3 hanya mendapat hadiah kontribusi Rp5.000 per pemenang.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======================
    // TOKEN OPEN API (punyamu)
    // ======================
    var tokenapi = "eyJhcHAiOiIxNjMwMTciLCJhdXRoIjoiMjAyNDA5MTAiLCJzaWduIjoiU2JmTEdJcTFpb0h1OVBTU3hqMzVPdz09In0=";

    // ======================
    // ENDPOINT TRANSAKSI
    // Kalau kamu tau endpoint transaksi yang benar, isi TX_ENDPOINT.
    // Kalau kosong, dia AUTO coba beberapa endpoint umum.
    // ======================
    var TX_ENDPOINT = ""; // contoh: "https://openapi.bukaolshop.net/v1/app/transaksi"
    var TX_ENDPOINT_CANDIDATES = [
      "https://openapi.bukaolshop.net/v1/app/transaksi",
      "https://openapi.bukaolshop.net/v1/app/riwayat_transaksi",
      "https://openapi.bukaolshop.net/v1/app/history_transaksi",
      "https://openapi.bukaolshop.net/v1/app/order",
      "https://openapi.bukaolshop.net/v1/app/riwayat_order",
      "https://openapi.bukaolshop.net/v1/app/history_order"
    ];

    // ======================
    // UI Helpers
    // ======================
    const el = (id) => document.getElementById(id);

    function setActiveTab(which){
      const isLb = which === "leaderboard";
      el("tabLeaderboard").classList.toggle("active", isLb);
      el("tabInfo").classList.toggle("active", !isLb);
      el("viewLeaderboard").style.display = isLb ? "" : "none";
      el("viewInfo").style.display = isLb ? "none" : "";
    }
    el("tabLeaderboard").addEventListener("click", () => setActiveTab("leaderboard"));
    el("tabInfo").addEventListener("click", () => setActiveTab("info"));

    function setStatus(type, msg){
      const box = el("status");
      if(!msg){ box.innerHTML = ""; return; }
      const cls = type === "error" ? "error" : "loading";
      box.innerHTML = `<div class="${cls}">${msg}</div>`;
    }

    function maskName(name){
      if(!name) return "-";
      name = String(name);
      if(name.length <= 2) return name[0] + "*";
      return name.slice(0,2) + "*".repeat(Math.min(10, name.length-2));
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderLeaderboard(items){
      const top1 = items[0] || null;
      const top2 = items[1] || null;
      const top3 = items[2] || null;

      el("name1").textContent = top1 ? maskName(top1.name) : "-";
      el("trx1").textContent  = top1 ? `${top1.trxCount} Trx` : "- Trx";

      el("name2").textContent = top2 ? maskName(top2.name) : "-";
      el("trx2").textContent  = top2 ? `${top2.trxCount} Trx` : "- Trx";

      el("name3").textContent = top3 ? maskName(top3.name) : "-";
      el("trx3").textContent  = top3 ? `${top3.trxCount} Trx` : "- Trx";

      const list = el("list");
      list.innerHTML = "";

      const rest = items.slice(3, 10);
      if(rest.length === 0){
        list.innerHTML = `<div class="muted" style="padding:6px 8px 14px;">Belum ada data.</div>`;
        return;
      }

      for(let i=0;i<rest.length;i++){
        const rank = i + 4;
        const it = rest[i];
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
          <div class="rank">${rank}</div>
          <div class="avatar">üë§</div>
          <div class="rowMain">
            <div class="rowName">${escapeHtml(maskName(it.name))}</div>
          </div>
          <div class="rowTrx">${it.trxCount}<div class="muted" style="text-align:right;margin-top:-2px;">Trx</div></div>
        `;
        list.appendChild(row);
      }
    }

    function updateMonthLabel(month){
      const map = {
        "2026-02":"Februari 2026",
        "2026-01":"Januari 2026",
        "2025-12":"Desember 2025",
      };
      const label = map[month] || month;
      el("tabLeaderboard").textContent = label;
    }

    // ======================
    // TRIK AMBIL DATA (XMLHttpRequest + ?token=...)
    // ======================
    function openApiGet(url, onOk, onFail){
      var xhr = new XMLHttpRequest();
      xhr.open("GET", url, true);
      xhr.onreadystatechange = function(){
        if (xhr.readyState === 4){
          if (xhr.status === 200){
            try{
              onOk(JSON.parse(xhr.responseText));
            }catch(e){
              onFail && onFail("JSON parse error");
            }
          }else{
            onFail && onFail("HTTP " + xhr.status);
          }
        }
      };
      xhr.send();
    }

    function pad2(n){ return String(n).padStart(2,"0"); }
    function monthRange(month){
      var y = parseInt(month.split("-")[0],10);
      var m = parseInt(month.split("-")[1],10);
      var start = new Date(y, m-1, 1);
      var end = new Date(y, m, 1);
      function toStr(d){ return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate()); }
      return { start: toStr(start), end: toStr(end) };
    }

    function loadLeaderboard(month){
      setStatus("loading", "Memuat transaksi‚Ä¶");

      const endpoints = (TX_ENDPOINT && TX_ENDPOINT.trim() !== "")
        ? [TX_ENDPOINT.trim()]
        : TX_ENDPOINT_CANDIDATES.slice();

      tryEndpoints(endpoints, month, function(items){
        renderLeaderboard(items);
        setStatus(null, null);
      }, function(err){
        renderLeaderboard([]);
        setStatus("error", "Gagal ambil transaksi. " + err + " (isi TX_ENDPOINT kalau endpoint transaksi kamu beda)");
      });
    }

    function tryEndpoints(endpoints, month, onSuccess, onAllFail){
      if(!endpoints.length){
        onAllFail("Endpoint transaksi tidak ketemu (semua kandidat gagal).");
        return;
      }

      var ep = endpoints.shift();
      var r = monthRange(month);

      // sama gaya kamu: token di query string
      var url = ep
        + "?token=" + encodeURIComponent(tokenapi)
        + "&total_data=500"
        + "&start_date=" + encodeURIComponent(r.start)
        + "&end_date=" + encodeURIComponent(r.end)
        + "&status=SUCCESS";

      openApiGet(url, function(json){
        // ambil array transaksi (fleksibel)
        var txs = json.data || json.transactions || json.riwayat || [];

        // group count per member
        var map = {};
        for (var i=0;i<txs.length;i++){
          var t = txs[i];

          // status (fleksibel)
          var st = (t.status || t.status_transaksi || t.state || "").toString().toUpperCase();
          if(st){
            var ok = (st === "SUCCESS" || st === "SELESAI" || st === "BERHASIL" || st === "DONE" || st === "SUCCESSFUL");
            if(!ok) continue;
          }

          // tanggal (kalau format ISO "YYYY-MM-..", filter by month)
          var dt = (t.tanggal || t.created_at || t.waktu || t.date || t.tgl || "").toString();
          if(dt && dt.length >= 7 && dt.indexOf("-") !== -1){
            // kalau ISO, cocok; kalau bukan ISO, kita tidak paksa supaya tidak kebuang
            if(dt.startsWith(month) === false){
              // biarin
            }
          }

          // nama user/member (fleksibel)
          var name =
            t.nama_member ||
            t.username ||
            t.nama_pembeli ||
            t.customer_name ||
            (t.pembeli && t.pembeli.nama) ||
            (t.user && t.user.nama) ||
            "Unknown";

          map[name] = (map[name] || 0) + 1;
        }

        var items = Object.keys(map)
          .map(function(name){ return { name:name, trxCount: map[name] }; })
          .sort(function(a,b){ return b.trxCount - a.trxCount; })
          .slice(0,10);

        onSuccess(items);
      }, function(){
        // endpoint ini gagal, lanjut kandidat berikutnya
        tryEndpoints(endpoints, month, onSuccess, onAllFail);
      });
    }

    // ======================
    // init
    // ======================
    const monthSelect = el("monthSelect");
    monthSelect.addEventListener("change", () => {
      const month = monthSelect.value;
      updateMonthLabel(month);
      loadLeaderboard(month);
      setActiveTab("leaderboard");
    });

    updateMonthLabel(monthSelect.value);
    loadLeaderboard(monthSelect.value);
  </script>
</body>
  </html>
